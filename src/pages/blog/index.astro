---
import Layout from "../../layouts/Layout.astro";
import { Image } from "astro:assets";
import { getAllPosts } from "../../lib/notion";

const posts = await getAllPosts();

// Extract all unique tags
const allTags = new Set<string>();
posts.forEach((post) => {
  if (post.tags) {
    post.tags.forEach((tag) => allTags.add(tag));
  }
});
const uniqueTags = Array.from(allTags).sort();
---

<Layout title="‡∏ö‡∏•‡πá‡∏≠‡∏Å" description="‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">
  <section id="blog" class="overflow-hidden relative mb-16">
    <section id="blog-posts" class="py-8">
      <div class="flex flex-col items-center justify-center gap-2 mt-10 mb-4">
        <div class="flex flex-row items-center justify-center gap-2">
          <span
            class="w-10 h-10 bg-primary text-white rounded-full items-center justify-center text-xl inline-flex"
            >üìö</span
          ><h1 class="text-3xl font-bold">‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h1>
        </div>
      </div>
      <p class="text-center text-gray-600 mb-12">‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤</p>
      
      <hr class="my-12 border-neutral-200" />

      <!-- Tag Filter Bar -->
      <div class="mb-8 flex flex-wrap gap-2 justify-center">
        <a
          href="/blog"
          class="px-4 py-2 rounded-full bg-primary text-white hover:bg-primary/80 transition-colors font-medium"
        >
          ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </a>
        {
          uniqueTags.map((tag) => (
            <a
              href={`/blog/tag/${tag}`}
              class="px-4 py-2 rounded-full bg-gray-200 text-gray-700 hover:bg-primary hover:text-white transition-colors font-medium"
            >
              {tag}
            </a>
          ))
        }
      </div>

      <hr class="my-12 border-neutral-200" />

      <div class="article grid md:grid-cols-3 gap-6">
        {
          posts.map((post) => (
            <a
              href={`/blog/${post.slug}`}
              class="group flex flex-col gap-4 p-0 justify-start items-center rounded-lg overflow-hidden border border-neutral-200 hover:shadow-lg transition-shadow"
            >
              {post.cover ? (
                <figure class="shrink-0 w-full relative overflow-hidden">
                  <Image
                    src={post.cover}
                    alt={post.title}
                    width={800}
                    height={400}
                    class="aspect-video object-cover group-hover:scale-105 transition-all duration-700 ease-in-out group-hover:brightness-90"
                  />
                </figure>
              ) : null}
              <div class="relative overflow-hidden px-4">
                <time class="text-xs text-gray-500">
                  {new Date(post.created).toLocaleString("th-TH", {
                    dateStyle: "long",
                  })}
                </time>
                <h3 class="text-lg font-semibold text-primary md:text-xl leading-tight mt-2">
                  {post.title}
                </h3>
                <p class="mt-2 text-gray-600 line-clamp-3">
                  {post.description}
                </p>
                <div class="my-4 flex flex-row items-center justify-start flex-wrap gap-2">
                  {post.tags &&
                    post.tags.map((tag: string) => (
                      <span
                        class="inline-block rounded-full bg-gray-200 px-2 py-1 text-xs text-gray-700"
                      >
                        {tag}
                      </span>
                    ))}
                </div>
              </div>
            </a>
          ))
        }
      </div>
    </section>
  </section>
</Layout>
